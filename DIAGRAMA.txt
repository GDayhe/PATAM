DIAGRAMA DEL SISTEMA - PAT ALTO MIJARES
========================================

FLUJO DE DATOS
──────────────

    USUARIO
       ↓
       ├─→ Abre PATaltomijares.html
       ├─→ Va a "Participación"
       ├─→ Rellena formulario
       └─→ Envía
            ↓
       FORMULARIO HTML
            ↓
       VALIDACIÓN CLIENTE (JS)
       ├─ ¿Campos vacíos?
       ├─ ¿Email válido?
       ├─ ¿Municipio seleccionado?
       └─ ¿Comentarios?
            ↓
       ENVÍO FETCH API
            ↓
       PROCESAR_ENCUESTA.PHP
            ↓
       VALIDACIÓN SERVIDOR (PHP)
       ├─ Sanitizar entrada
       ├─ Validar email
       ├─ Validar municipio
       ├─ Validar tipo
       └─ Validar comentarios
            ↓
       PREPARAR EMAILS
            ↓
       ├─→ EMAIL AL ADMIN
       │   └─→ pataltomijares@gmail.com
       │
       ├─→ EMAIL AL USUARIO
       │   └─→ email_del_participante@...
       │
       └─→ GUARDAR EN BD (opcional)
           └─→ Base de datos MySQL


ARQUITECTURA
────────────

CLIENTE (Navegador)
└─ PATaltomijares.html
   ├─ Formulario HTML
   ├─ CSS (diseño)
   └─ JavaScript (validación + fetch)


SERVIDOR
├─ procesar_encuesta.php
│  ├─ Recibir datos POST
│  ├─ Validar
│  ├─ Procesar
│  └─ Responder JSON
│
├─ config_encuestas.php
│  ├─ Constantes
│  ├─ Funciones
│  └─ Configuración
│
└─ FUNCIÓN mail() PHP
   ├─ SMTP del servidor
   └─ Envío de emails


BASE DE DATOS (OPCIONAL)
├─ Tabla: encuestas
├─ Campos: id, nombre, email, municipio, etc.
└─ Acceso: PHPMyAdmin


LOGS (OPCIONAL)
└─ /logs/encuestas.log
   ├─ Fecha/hora de cada acción
   ├─ Errores
   └─ Información de auditoría


COMPONENTES
───────────

[OBLIGATORIOS]
✓ PATaltomijares.html
✓ procesar_encuesta.php
✓ config_encuestas.php

[RECOMENDADOS]
✓ .htaccess (seguridad)

[OPCIONALES]
✓ dashboard.html (admin panel)
✓ test.php (diagnósticos)
✓ BD MySQL (almacenamiento)


CICLO DE UNA RESPUESTA
──────────────────────

1. Usuario accede a HTML
   ├─ Navegador carga PATaltomijares.html
   ├─ Descarga CSS y JS
   └─ Se muestra el formulario

2. Usuario rellena formulario
   ├─ Nombre: "Juan García"
   ├─ Email: "juan@example.com"
   ├─ Municipio: "Arañuel"
   ├─ Tipo: "Propuesta"
   └─ Comentarios: "..."

3. Usuario hace click en "Enviar"
   ├─ JavaScript valida
   ├─ Si hay error: muestra mensaje
   └─ Si está OK: envía datos

4. Datos viajan a servidor
   ├─ FETCH API POST
   ├─ procesar_encuesta.php
   └─ Recibe datos

5. PHP valida datos
   ├─ Sanitiza
   ├─ Valida cada campo
   └─ Si hay error: responde JSON error

6. Se preparan emails
   ├─ Email 1: datos completos para admin
   ├─ Email 2: confirmación para usuario
   └─ Headers MIME correctos

7. Se envían emails
   ├─ PHP mail() → Admin
   ├─ PHP mail() → Usuario
   └─ (usando SMTP del servidor)

8. Se guardan datos (opcional)
   ├─ Si BD habilitada
   ├─ INSERT en tabla encuestas
   └─ Con fecha/hora/IP

9. Se registra en logs (opcional)
   ├─ Si logs habilitados
   ├─ Archivo /logs/encuestas.log
   └─ Registro de la operación

10. Se responde al cliente
    ├─ JSON: {"success": "..."}
    ├─ JavaScript recibe
    ├─ Muestra mensaje de éxito
    └─ Limpia formulario

11. Usuario recibe email de confirmación
    ├─ Asunto: "Hemos recibido tu aportación"
    ├─ Resumen de datos
    └─ Firma: "Equipo PAT"

12. Admin recibe email con respuesta
    ├─ Asunto: "Nueva respuesta de encuesta"
    ├─ Todos los datos
    ├─ IP del usuario
    └─ Puede responder directamente


SEGURIDAD
─────────

ENTRADA
├─ htmlspecialchars()   → Previene XSS
├─ stripslashes()       → Elimina escapes
├─ trim()               → Elimina espacios
├─ filter_var()         → Valida email
└─ in_array()           → Valida opciones

VALIDACIÓN
├─ POST requerido       → No GET
├─ Campos obligatorios  → Validación
├─ Email válido         → RFC compliant
└─ Municipio en lista   → Validación

PROTECCIÓN
├─ No SQL injection     → Sin concatenación
├─ Sanitización         → Entrada limpia
├─ Logging              → Auditoría
└─ Rate limiting        → Puede agregarse


MUNICIPIOS SOPORTADOS
─────────────────────

01. Arañuel
02. Argelita
03. Ayódar
04. Castillo de Villamalefa
05. Cirat
06. Cortes de Arenoso
07. Espadilla
08. Fanzara
09. Fuentes de Ayódar
10. Fuente La Reina
11. Ludiente
12. Montán
13. Montanejos
14. Puebla de Arenoso
15. Toga
16. Torralba del Pinar
17. Torrechiva
18. Vallat
19. Villahermosa del Río
20. Villamalur
21. Villanueva de Viver
22. Zucaina
23. Otro


RENDIMIENTO
───────────

Validación cliente:     < 100 ms
Envío al servidor:      < 500 ms
Procesamiento servidor: < 1000 ms
Envío de emails:        < 2000 ms
─────────────────────────────────
TOTAL:                  ~ 3.5 seg


TECNOLOGÍAS
───────────

Frontend:
  - HTML5
  - CSS3
  - JavaScript (ES6)
  - Fetch API
  - FormData API

Backend:
  - PHP 5.6+
  - Función mail()
  - Expresiones regulares
  - Manejo de archivos

Opcional:
  - MySQL/MariaDB
  - Google Sheets
  - Google Forms


REQUISITOS DEL SERVIDOR
──────────────────────

Obligatorios:
  ✓ PHP 5.6 o superior
  ✓ Función mail() habilitada
  ✓ SMTP configurado

Opcionales:
  ✓ MySQL 5.5 o superior
  ✓ Acceso FTP/SFTP
  ✓ Soporte de .htaccess


COMPATIBILIDAD
──────────────

Navegadores:
  ✓ Chrome 90+
  ✓ Firefox 88+
  ✓ Safari 14+
  ✓ Edge 90+
  ✓ Opera 76+

Dispositivos:
  ✓ Desktop
  ✓ Laptop
  ✓ Tablet
  ✓ Mobile

Servidores:
  ✓ Linux
  ✓ Windows
  ✓ macOS
  ✓ BSD


CONFIGURACIÓN
─────────────

config_encuestas.php define:

EMAIL_DESTINO
└─ pataltomijares@gmail.com

EMAIL_REMITENTE
└─ noreply@pataltomijares.es

REGISTRAR_IP
└─ true (auditoría)

HABILITAR_LOGS
└─ true (registro de actividad)

USAR_BASE_DATOS
└─ false (opcional)


PRÓXIMOS PASOS
──────────────

1. Lee START_HERE.md (5 min)
2. Lee GUIA_RAPIDA.md (10 min)
3. Sube archivos al servidor (5 min)
4. Ejecuta test.php (2 min)
5. Prueba el formulario (2 min)
6. Verifica emails (1 min)

TOTAL: 25 minutos


CONTACTO
────────

Email: pataltomijares@gmail.com
Docs: Todos los archivos .md
Soporte: README_ENCUESTAS.md


STATUS: ✅ COMPLETAMENTE FUNCIONAL
VERSIÓN: 1.0
FECHA: ENERO 2026

═══════════════════════════════════════════════════════════════════════════════
